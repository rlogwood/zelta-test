+ set +e
+ zfs list
NAME                                     USED  AVAIL  REFER  MOUNTPOINT
apool                                   2.08M  1.76T    24K  /apool
apool/treetop                           1.70M  1.76T    90K  /apool/treetop
apool/treetop/add                         48K  1.76T    24K  /apool/treetop/add
apool/treetop/add/7                       24K  1.76T    24K  /apool/treetop/add/7
apool/treetop/minus                     1.18M  1.76T    89K  /apool/treetop/minus
apool/treetop/minus/two                  963K  1.76T    89K  /apool/treetop/minus/two
apool/treetop/minus/two/one              722K  1.76T    89K  /apool/treetop/minus/two/one
apool/treetop/minus/two/one/0            481K  1.76T    89K  /apool/treetop/minus/two/one/0
apool/treetop/minus/two/one/0/lift off   240K  1.76T    88K  /apool/treetop/minus/two/one/0/lift off
apool/treetop/vol1                       234K  1.76T    78K  -
bpool                                   2.09M  1.76T    24K  /bpool
bpool/treetop                           1.69M  1.76T    89K  /bpool/treetop
bpool/treetop/minus                     1.18M  1.76T    89K  /bpool/treetop/minus
bpool/treetop/minus/two                  963K  1.76T    89K  /bpool/treetop/minus/two
bpool/treetop/minus/two/one              722K  1.76T    89K  /bpool/treetop/minus/two/one
bpool/treetop/minus/two/one/0            481K  1.76T    89K  /bpool/treetop/minus/two/one/0
bpool/treetop/minus/two/one/0/lift off   240K  1.76T    88K  /bpool/treetop/minus/two/one/0/lift off
bpool/treetop/sub                         48K  1.76T    24K  /bpool/treetop/sub
bpool/treetop/sub/8                       24K  1.76T    24K  /bpool/treetop/sub/8
bpool/treetop/vol1                       234K  1.76T    78K  -
+ dataset_arg=bpool/Backups/apool
+ zelta backup apool bpool/Backups/apool
+ backup_output=source snapshot created: @2024-05-29_02.57.15
replicating 27 streams
1M sent, 34/34 streams received in 1.32 seconds
+ find_last_snapshot_name bpool/Backups/apool
+ dataset_name=bpool/Backups/apool
+ entry=
+ [ -z  ]
+ filter=tail -1
+ cmd=zfs list -t snapshot -o name,creation -s creation -r bpool/Backups/apool | grep "bpool/Backups/apool@" | tail -1 | awk -F'@' '{print $2}' | awk '{print $1}'
+ eval zfs list -t snapshot -o name,creation -s creation -r bpool/Backups/apool | grep "bpool/Backups/apool@" | tail -1 | awk -F'@' '{print $2}' | awk '{print $1}'
+ zfs list -t snapshot -o name,creation -s creation -r bpool/Backups/apool
+ grep bpool/Backups/apool@
+ tail -1
+ + awk -F@ {print $2}
awk {print $1}
+ last_snapshot_name=2024-05-29_02.57.15
+ echo 2024-05-29_02.57.15
+ last_snapshot_name=2024-05-29_02.57.15
+ echo last_snapshot_name: 2024-05-29_02.57.15
last_snapshot_name: 2024-05-29_02.57.15
+ cat
+ placeholder_output=source snapshot created: @{last_snapshot_name} replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ cmd=echo "source snapshot created: @{last_snapshot_name} replicating 27 streams 1M sent, 34/34 streams received in {time} seconds" | sed s/{last_snapshot_name}/2024-05-29_02.57.15/g | sed 's/received in [0-9.]\+ seconds/received in {time} seconds/'
+ eval echo "source snapshot created: @{last_snapshot_name} replicating 27 streams 1M sent, 34/34 streams received in {time} seconds" | sed s/{last_snapshot_name}/2024-05-29_02.57.15/g | sed 's/received in [0-9.]\+ seconds/received in {time} seconds/'
+ echo source snapshot created: @{last_snapshot_name} replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ sed s/{last_snapshot_name}/2024-05-29_02.57.15/g
+ sed s/received in [0-9.]\+ seconds/received in {time} seconds/
+ expected_output=source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ echo source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in 1.32 seconds
+ sed s/received in [0-9.]\+ seconds/received in {time} seconds/
+ backup_output_no_time=source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ echo ** last_snapshot_name is 2024-05-29_02.57.15
** last_snapshot_name is 2024-05-29_02.57.15
+ echo backup command output without time is:
backup command output without time is:
+ echo source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ echo 

+ echo expected output is:
expected output is:
+ echo source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds
+ echo 

+ [ source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds = source snapshot created: @2024-05-29_02.57.15 replicating 27 streams 1M sent, 34/34 streams received in {time} seconds ]
+ echo Output matches expected
Output matches expected
+ exit 0
