+ set -x
+ set +e
+ dataset_arg=apool
+ find_last_snapshot_name apool
+ dataset_name=apool
+ entry=
+ [ -z  ]
+ filter=tail -1
+ cmd=zfs list -t snapshot -o name,creation -s creation -r apool | grep "apool@" | tail -1 | awk -F'@' '{print $2}' | awk '{print $1}'
+ eval zfs list -t snapshot -o name,creation -s creation -r apool | grep "apool@" | tail -1 | awk -F'@' '{print $2}' | awk '{print $1}'
+ zfs list -t snapshot -o name,creation -s creation -r apool
+ + grep apool@
tail -1
+ awk -F@ {print $2}
+ awk {print $1}
+ last_snapshot_name=2024-05-29_02.57.15
+ echo 2024-05-29_02.57.15
+ last_snapshot_name=2024-05-29_02.57.15
+ echo last snapshot: 2024-05-29_02.57.15
last snapshot: 2024-05-29_02.57.15
+ zelta sync -R apool bpool/Backups/apool-backup
+ sync_output=replicating 1 streams
skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist
cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system
1M sent, 34/34 streams received in 3.15 seconds
+ zfs list -r bpool/Backups/apool-backup
NAME                                                                 USED  AVAIL  REFER  MOUNTPOINT
bpool/Backups/apool-backup                                          1.72M  1.76T    24K  /bpool/Backups/apool-backup
bpool/Backups/apool-backup/treetop-backup                           1.70M  1.76T    90K  /bpool/Backups/apool-backup/treetop-backup
bpool/Backups/apool-backup/treetop-backup/add                         48K  1.76T    24K  /bpool/Backups/apool-backup/treetop-backup/add
bpool/Backups/apool-backup/treetop-backup/add/7                       24K  1.76T    24K  /bpool/Backups/apool-backup/treetop-backup/add/7
bpool/Backups/apool-backup/treetop-backup/minus                     1.18M  1.76T    89K  /bpool/Backups/apool-backup/treetop-backup/minus
bpool/Backups/apool-backup/treetop-backup/minus/two                  963K  1.76T    89K  /bpool/Backups/apool-backup/treetop-backup/minus/two
bpool/Backups/apool-backup/treetop-backup/minus/two/one              722K  1.76T    89K  /bpool/Backups/apool-backup/treetop-backup/minus/two/one
bpool/Backups/apool-backup/treetop-backup/minus/two/one/0            481K  1.76T    89K  /bpool/Backups/apool-backup/treetop-backup/minus/two/one/0
bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off   240K  1.76T    88K  /bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off
bpool/Backups/apool-backup/treetop-backup/vol1                       234K  1.76T    78K  -
+ echo sync_output
sync_output
+ echo replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in 3.15 seconds
replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in 3.15 seconds
+ cat
+ placeholder_output=replicating 1 streams
skipping dataset apool/treetop: snapshot {last_snapshot_name} does not exist
cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system
1M sent, 34/34 streams received in {time} seconds
+ cmd=echo "replicating 1 streams
skipping dataset apool/treetop: snapshot {last_snapshot_name} does not exist
cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system
cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system
1M sent, 34/34 streams received in {time} seconds" | sed s/{last_snapshot_name}/2024-05-29_02.57.15/g | sed 's/received in [0-9.]\+ seconds/received in {time} seconds/'
+ eval echo "replicating 1 streams skipping dataset apool/treetop: snapshot {last_snapshot_name} does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds" | sed s/{last_snapshot_name}/2024-05-29_02.57.15/g | sed 's/received in [0-9.]\+ seconds/received in {time} seconds/'
+ echo replicating 1 streams skipping dataset apool/treetop: snapshot {last_snapshot_name} does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
+ sed s/{last_snapshot_name}/2024-05-29_02.57.15/g
+ sed s/received in [0-9.]\+ seconds/received in {time} seconds/
+ expected_output=replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
+ echo replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in 3.15 seconds
+ sed s/received in [0-9.]\+ seconds/received in {time} seconds/
+ sync_output_no_time=replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
+ echo sync command output without time is:
sync command output without time is:
+ echo replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
+ echo 

+ echo expected output is:
expected output is:
+ echo replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds
+ echo 

+ [ replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds = replicating 1 streams skipping dataset apool/treetop: snapshot 2024-05-29_02.57.15 does not exist cannot mount '/bpool/Backups/apool-backup/treetop-backup': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/add/7': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0': failed to create mountpoint: Read-only file system cannot mount '/bpool/Backups/apool-backup/treetop-backup/minus/two/one/0/lift off': failed to create mountpoint: Read-only file system 1M sent, 34/34 streams received in {time} seconds ]
+ echo Output matches expected
Output matches expected
+ exit 0
